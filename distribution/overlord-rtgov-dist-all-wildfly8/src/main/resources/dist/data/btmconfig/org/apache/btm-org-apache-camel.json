{
  "instrumentation": {
    "org.apache.camel": {
      "description": "Apache Camel instrumentation",
      "rules": [{
        "ruleName": "Apache Camel Exchange Constructor Correlation",
        "className": "org.apache.camel.impl.DefaultExchange",
        "methodName": "<init>",
        "parameterTypes": [
           "org.apache.camel.Exchange"
        ],
        "location": "ENTRY",
        "condition": "!isActive() && isCorrelated(\"org.apache.camel-component\"+$1.getExchangeId())",
        "actions": [{
          "type": "Correlate",
          "idExpression": "\"org.apache.camel-component\"+$1.getExchangeId()"
        },{
          "type": "InitiateCorrelation",
          "idExpression": "\"org.apache.camel-component\"+$0.getExchangeId()"
        }]
      },{
        "ruleName": "Apache Camel Inbound Component Pre Start",
        "className": "org.apache.camel.util.EventHelper",
        "methodName": "notifyExchangeCreated",
        "parameterTypes": [
           "org.apache.camel.CamelContext",
           "org.apache.camel.Exchange"
        ],
        "location": "ENTRY",
        "condition": "$2.getFromEndpoint() != null && !isInstanceOf($2.getFromEndpoint(),org.apache.camel.component.seda.SedaEndpoint.class) && !isInstanceOf($2.getFromEndpoint(),org.apache.camel.component.direct.DirectEndpoint.class) && !isActive() && isCorrelated(\"org.apache.camel-component\"+$2.getExchangeId())",
        "actions": [{
          "type": "Correlate",
          "idExpression": "\"org.apache.camel-component\"+$2.getExchangeId()"
        }]
      },{
        "ruleName": "Apache Camel Inbound Component Start",
        "className": "org.apache.camel.util.EventHelper",
        "methodName": "notifyExchangeCreated",
        "parameterTypes": [
           "org.apache.camel.CamelContext",
           "org.apache.camel.Exchange"
        ],
        "location": "ENTRY",
        "condition": "$2.getFromEndpoint() != null && !isInstanceOf($2.getFromEndpoint(),org.apache.camel.component.seda.SedaEndpoint.class) && !isInstanceOf($2.getFromEndpoint(),org.apache.camel.component.direct.DirectEndpoint.class) && activate($2.getFromEndpoint().getEndpointUri())",
        "actions": [{
          "type": "InstrumentComponent",
          "direction": "In",
          "componentTypeExpression": "removeSuffix(simpleClassName($2.getFromEndpoint()),\"Endpoint\")",
          "uriExpression": "$2.getFromEndpoint().getEndpointUri()"
        },{
          "type": "SetDetail",
          "name": "btm_source",
          "valueExpression": "\"org.apache.camel\""
        },{
          "type": "InitiateCorrelation",
          "idExpression": "\"org.apache.camel-component\"+$2.getExchangeId()"
        }]
      },{
        "ruleName": "Apache Camel Inbound Component Pre End",
        "className": "org.apache.camel.util.EventHelper",
        "methodName": "notifyExchangeDone",
        "parameterTypes": [
           "org.apache.camel.CamelContext",
           "org.apache.camel.Exchange"
        ],
        "location": "ENTRY",
        "condition": "!isActive() && isCorrelated(\"org.apache.camel-component\"+$2.getExchangeId()) && $2.getFromEndpoint() != null && !isInstanceOf($2.getFromEndpoint(),org.apache.camel.component.seda.SedaEndpoint.class) && !isInstanceOf($2.getFromEndpoint(),org.apache.camel.component.direct.DirectEndpoint.class)",
        "actions": [{
          "type": "CompleteCorrelation",
          "idExpression": "\"org.apache.camel-component\"+$2.getExchangeId()"
        }]
      },{
        "ruleName": "Apache Camel Inbound Component End",
        "className": "org.apache.camel.util.EventHelper",
        "methodName": "notifyExchangeDone",
        "parameterTypes": [
           "org.apache.camel.CamelContext",
           "org.apache.camel.Exchange"
        ],
        "location": "ENTRY",
        "condition": "isActive() && $2.getFromEndpoint() != null && !isInstanceOf($2.getFromEndpoint(),org.apache.camel.component.seda.SedaEndpoint.class) && !isInstanceOf($2.getFromEndpoint(),org.apache.camel.component.direct.DirectEndpoint.class)",
        "actions": [{
          "type": "InstrumentComponent",
          "direction": "Out",
          "componentTypeExpression": "removeSuffix(simpleClassName($2.getFromEndpoint()),\"Endpoint\")",
          "uriExpression": "$2.getFromEndpoint().getEndpointUri()"
        }]
      },{
        "ruleName": "Apache Camel Outbound Component Pre Start",
        "notes": [
          "If the exchange has an active correlation, but the thread is not currently active, then correlate the thread to the session"
        ],
        "className": "org.apache.camel.util.EventHelper",
        "methodName": "notifyExchangeSending",
        "parameterTypes": [
           "org.apache.camel.CamelContext",
           "org.apache.camel.Exchange",
           "org.apache.camel.Endpoint"
        ],
        "location": "ENTRY",
        "condition": "$3 != null && !isInstanceOf($3,org.apache.camel.component.seda.SedaEndpoint.class) && !isInstanceOf($3,org.apache.camel.component.direct.DirectEndpoint.class) && !isActive() && isCorrelated(\"org.apache.camel-component\"+$2.getExchangeId())",
        "actions": [{
          "type": "Correlate",
          "idExpression": "\"org.apache.camel-component\"+$2.getExchangeId()"
        }]
      },{
        "ruleName": "Apache Camel Outbound Component Start",
        "className": "org.apache.camel.util.EventHelper",
        "methodName": "notifyExchangeSending",
        "parameterTypes": [
           "org.apache.camel.CamelContext",
           "org.apache.camel.Exchange",
           "org.apache.camel.Endpoint"
        ],
        "location": "ENTRY",
        "condition": "$3 != null && !isInstanceOf($3,org.apache.camel.component.seda.SedaEndpoint.class) && !isInstanceOf($3,org.apache.camel.component.direct.DirectEndpoint.class) && activate($3.getEndpointUri())",
        "actions": [{
          "type": "InstrumentComponent",
          "direction": "In",
          "componentTypeExpression": "removeSuffix(simpleClassName($3),\"Endpoint\")",
          "uriExpression": "$3.getEndpointUri()"
        },{
          "type": "SetDetail",
          "name": "btm_source",
          "valueExpression": "\"org.apache.camel\""
        }]
      },{
        "ruleName": "Apache Camel Outbound Component Pre End",
        "notes": [
          "If the exchange has an active correlation, but the thread is not currently active, then correlate the thread to the session"
        ],
        "className": "org.apache.camel.util.EventHelper",
        "methodName": "notifyExchangeSent",
        "parameterTypes": [
           "org.apache.camel.CamelContext",
           "org.apache.camel.Exchange",
           "org.apache.camel.Endpoint",
           "long"
        ],
        "location": "ENTRY",
        "condition": "$3 != null && !isInstanceOf($3,org.apache.camel.component.seda.SedaEndpoint.class) && !isInstanceOf($3,org.apache.camel.component.direct.DirectEndpoint.class) && !isActive() && isCorrelated(\"org.apache.camel-component\"+$2.getExchangeId())",
        "actions": [{
          "type": "Correlate",
          "idExpression": "\"org.apache.camel-component\"+$2.getExchangeId()"
        }]
      },{
        "ruleName": "Apache Camel Outbound Component End",
        "notes": [
          "Unlink after handling the end of the component, as may not continue with other activities on this thread"
        ],
        "className": "org.apache.camel.util.EventHelper",
        "methodName": "notifyExchangeSent",
        "parameterTypes": [
           "org.apache.camel.CamelContext",
           "org.apache.camel.Exchange",
           "org.apache.camel.Endpoint",
           "long"
        ],
        "location": "ENTRY",
        "condition": "$3 != null && !isInstanceOf($3,org.apache.camel.component.seda.SedaEndpoint.class) && !isInstanceOf($3,org.apache.camel.component.direct.DirectEndpoint.class) && isActive()",
        "actions": [{
          "type": "InstrumentComponent",
          "direction": "Out",
          "componentTypeExpression": "removeSuffix(simpleClassName($3),\"Endpoint\")",
          "uriExpression": "$3.getEndpointUri()"
        },{
          "type": "Unlink"
        }]
      },{
        "ruleName": "Apache Camel Inbound Consumer Start",
        "className": "org.apache.camel.util.EventHelper",
        "methodName": "notifyExchangeCreated",
        "parameterTypes": [
           "org.apache.camel.CamelContext",
           "org.apache.camel.Exchange"
        ],
        "location": "ENTRY",
        "condition": "isInstanceOf($2.getFromEndpoint(),org.apache.camel.component.seda.SedaEndpoint.class) && activate($2.getFromEndpoint().getEndpointUri(),$2.getProperty(\"HawkularBTID\"))",
        "actions": [{
          "type": "SetName",
          "nameExpression": "$2.getProperty(\"HawkularBTName\")"
        },{
          "type": "InstrumentConsumer",
          "direction": "In",
          "endpointTypeExpression": "removeSuffix(simpleClassName($2.getFromEndpoint()),\"Endpoint\")",
          "uriExpression": "$2.getFromEndpoint().getEndpointUri()",
          "idExpression": "$2.getProperty(\"HawkularBTID\")"
        },{
          "type": "SetDetail",
          "name": "btm_source",
          "valueExpression": "\"org.apache.camel\""
        },{
          "type": "FreeFormAction",
          "action": "$2.removeProperty(\"HawkularBTID\")"
        }]
      },{
        "ruleName": "Apache Camel Inbound Consumer End",
        "className": "org.apache.camel.util.EventHelper",
        "methodName": "notifyExchangeDone",
        "parameterTypes": [
           "org.apache.camel.CamelContext",
           "org.apache.camel.Exchange"
        ],
        "location": "ENTRY",
        "condition": "isInstanceOf($2.getFromEndpoint(),org.apache.camel.component.seda.SedaEndpoint.class) && isActive()",
        "actions": [{
          "type": "InstrumentConsumer",
          "direction": "Out",
          "endpointTypeExpression": "removeSuffix(simpleClassName($2.getFromEndpoint()),\"Endpoint\")",
          "uriExpression": "$2.getFromEndpoint().getEndpointUri()"
        }]
      },{
        "ruleName": "Apache Camel Outbound Producer Start",
        "className": "org.apache.camel.util.EventHelper",
        "methodName": "notifyExchangeSending",
        "parameterTypes": [
           "org.apache.camel.CamelContext",
           "org.apache.camel.Exchange",
           "org.apache.camel.Endpoint"
        ],
        "location": "ENTRY",
        "binds": [{
          "name": "id",
          "type": "java.lang.String",
          "expression": "createUUID()"
        }],
        "condition": "isInstanceOf($3,org.apache.camel.component.seda.SedaEndpoint.class) && activate($3.getEndpointUri())",
        "actions": [{
          "type": "InstrumentProducer",
          "direction": "In",
          "endpointTypeExpression": "removeSuffix(simpleClassName($3),\"Endpoint\")",
          "uriExpression": "$3.getEndpointUri()",
          "idExpression": "id"
        },{
          "type": "SetDetail",
          "name": "btm_source",
          "valueExpression": "\"org.apache.camel\""
        },{
          "type": "FreeFormAction",
          "action": "$2.setProperty(\"HawkularBTID\",id)"
        },{
          "type": "FreeFormAction",
          "action": "$2.setProperty(\"HawkularBTName\",getBusinessTransactionName())"
        }]
      },{
        "ruleName": "Apache Camel Outbound Producer End",
        "className": "org.apache.camel.util.EventHelper",
        "methodName": "notifyExchangeSent",
        "parameterTypes": [
           "org.apache.camel.CamelContext",
           "org.apache.camel.Exchange",
           "org.apache.camel.Endpoint",
           "long"
        ],
        "location": "ENTRY",
        "condition": "isInstanceOf($3,org.apache.camel.component.seda.SedaEndpoint.class) && isActive()",
        "actions": [{
          "type": "InstrumentProducer",
          "direction": "Out",
          "endpointTypeExpression": "removeSuffix(simpleClassName($3),\"Endpoint\")",
          "uriExpression": "$3.getEndpointUri()"
        }]
      }]
    }
  }
}
