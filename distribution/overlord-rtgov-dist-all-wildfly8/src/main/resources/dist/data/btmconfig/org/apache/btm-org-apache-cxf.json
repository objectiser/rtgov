{
  "instrumentation": {
    "org.apache.cxf": {
      "description": "Apache CXF Instrumentation",
      "rules": [{
        "ruleName": "Apache CXF Jetty HTTPDestination Consumer Start",
        "notes": [
          "This method was called one for the request, and then again for the response, but in a diff thread - so used link mechanism to firstly determine if call was first or second, then also to link the thread processing the response back to the original business txn session"
        ],
        "className": "^org.apache.cxf.transport.http_jetty.JettyHTTPDestination",
        "methodName": "doService",
        "parameterTypes": [
          "javax.servlet.ServletContext",
          "javax.servlet.http.HttpServletRequest",
          "javax.servlet.http.HttpServletResponse"
        ],
        "location": "ENTRY",
        "condition": "!isActive() && !isCorrelated(\"org.apache.cxf-jetty\"+$0.hashCode()) && activate($2.getRequestURL().toString(),$2.getHeader(\"Hawkular-btid\"))",
        "actions": [{
          "type": "SetName",
          "nameExpression": "$2.getHeader(\"Hawkular-btname\")"
        },{
          "type": "InstrumentConsumer",
          "direction": "In",
          "endpointTypeExpression": "\"HTTP\"",
          "uriExpression": "$2.getRequestURL().toString()",
          "idExpression": "$2.getHeader(\"Hawkular-btid\")"
        },{
          "type": "ProcessHeaders",
          "direction": "In",
          "originalType": "javax.servlet.http.HttpServletRequest",
          "headersExpression": "$2"
        },{
          "type": "SetDetail",
          "name": "btm_source",
          "valueExpression": "\"org.apache.cxf\""
        },{
          "type": "SetDetail",
          "name": "principal",
          "valueExpression": "$2.getRemoteUser()"
        },{
          "type": "SetDetail",
          "name": "remoteAddr",
          "valueExpression": "$2.getRemoteAddr()"
        },{
          "type": "SetDetail",
          "name": "remoteHost",
          "valueExpression": "$2.getRemoteHost()"
        },{
          "type": "InitiateCorrelation",
          "idExpression": "\"org.apache.cxf-jetty\"+$0.hashCode()"
        }]
      }]
    }
  }
}
